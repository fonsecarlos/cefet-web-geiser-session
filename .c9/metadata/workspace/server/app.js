{"filter":false,"title":"app.js","tooltip":"/server/app.js","undoManager":{"mark":4,"position":4,"stack":[[{"group":"doc","deltas":[{"start":{"row":14,"column":33},"end":{"row":15,"column":0},"action":"insert","lines":["",""]},{"start":{"row":15,"column":0},"end":{"row":15,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":2},"end":{"row":16,"column":0},"action":"insert","lines":["",""]},{"start":{"row":16,"column":0},"end":{"row":16,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":2},"end":{"row":23,"column":3},"action":"insert","lines":["if (req.session.views) {","    req.session.views++;","    res.setHeader('Content-Type', 'text/html');","    res.write('<p>views: ' + req.session.views + '</p>');","    res.end();","  } else {","    req.session.views = 1;","    res.end('welcome to the session demo. refresh!');","  }"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":2},"end":{"row":23,"column":3},"action":"remove","lines":["if (req.session.views) {","    req.session.views++;","    res.setHeader('Content-Type', 'text/html');","    res.write('<p>views: ' + req.session.views + '</p>');","    res.end();","  } else {","    req.session.views = 1;","    res.end('welcome to the session demo. refresh!');","  }"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":53,"column":0},"action":"remove","lines":["var express = require('express'),","    fs = require('fs'),","    _ = require('underscore'),","    app = express();","","var db = {","  jogadores: JSON.parse(fs.readFileSync(__dirname + '/data/jogadores.json')),","  jogosPorJogador: JSON.parse(fs.readFileSync(__dirname + '/data/jogosPorJogador.json'))","};","","app.set('port', process.env.PORT || 3000);","app.set('views', 'server/views');","app.set('view engine', 'hbs');","","app.get('/', function(req, res) {","  ","  ","  res.render('index', db.jogadores);","});","","app.get('/jogador/:id/', function(req, res) {","  var perfil = _.find(db.jogadores.players, function(el) { return el.steamid === req.params.id; });","  var jogos = db.jogosPorJogador[req.params.id];","","  // calcula o número jogos que nunca foram abertos","  jogos.not_played_count = _.where(jogos.games, { playtime_forever: 0 }).length;","","  // ordena por ordem decrescente de tempo de jogo (playtime_forever)","  jogos.games = _.sortBy(jogos.games, function(el) {","    return -el.playtime_forever;","  });","","  // mantém apenas os 5 primeiros","  jogos.games = _.head(jogos.games, 5);","","  // calcula tempo de jogo em horas, em vez de minutos","  jogos.games = _.map(jogos.games, function(el) {","    el.playtime_forever_h = Math.round(el.playtime_forever/60);","    return el;","  });","","  res.render('jogador', {","    profile: perfil,","    gameInfo: jogos,","    favorite: jogos.games[0]","  });","});","","app.use(express.static('client'));","","var server = app.listen(app.get('port'), function () {","  console.log('Servidor aberto em http://localhost:' + server.address().port);","});",""]},{"start":{"row":0,"column":0},"end":{"row":66,"column":0},"action":"insert","lines":["var express = require('express'),","    fs = require('fs'),","    _ = require('underscore'),","    app = express();","\t","var app = require('express')();","var session = require('express-session');","app.use(session({","  secret: 'octocats and octodogs'","}));","","var db = {","  jogadores: JSON.parse(fs.readFileSync(__dirname + '/data/jogadores.json')),","  jogosPorJogador: JSON.parse(fs.readFileSync(__dirname + '/data/jogosPorJogador.json'))","};","","app.set('port', process.env.PORT || 3000);","app.set('views', 'server/views');","app.set('view engine', 'hbs');","","app.get('/', function(req, res) {","  if (req.session.views) {","    req.session.views++;","  } else {","    req.session.views = 1;","  }","  res.render('index', {jogadores: db.jogadores, views: req.session.views});","});","","app.get('/jogador/:id/', function(req, res) {","  var perfil = _.find(db.jogadores.players, function(el) { return el.steamid === req.params.id; });","  var jogos = db.jogosPorJogador[req.params.id];","  if (req.session.views) {","    req.session.views++;","  } else {","    req.session.views = 1;","  }","  // calcula o número jogos que nunca foram abertos","  jogos.not_played_count = _.where(jogos.games, { playtime_forever: 0 }).length;","","  // ordena por ordem decrescente de tempo de jogo (playtime_forever)","  jogos.games = _.sortBy(jogos.games, function(el) {","    return -el.playtime_forever;","  });","","  // mantém apenas os 5 primeiros","  jogos.games = _.head(jogos.games, 5);","","  // calcula tempo de jogo em horas, em vez de minutos","  jogos.games = _.map(jogos.games, function(el) {","    el.playtime_forever_h = Math.round(el.playtime_forever/60);","    return el;","  });","","  res.render('jogador', {","    profile: perfil,","    gameInfo: jogos,","    favorite: jogos.games[0]","  });","});","","app.use(express.static('client'));","","var server = app.listen(app.get('port'), function () {","  console.log('Servidor aberto em http://localhost:' + server.address().port);","});",""]}]}]]},"ace":{"folds":[],"scrolltop":176,"scrollleft":0,"selection":{"start":{"row":66,"column":0},"end":{"row":66,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1421157607928,"hash":"5af66ec86305d1129acb6cdcbf889f29e7c4dfe3"}